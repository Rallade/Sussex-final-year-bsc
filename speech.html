<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Web Speech API</title>
    <style>
      body {
        font-family: monospace;
        font-size: 22px;
      }
    </style>
  </head>
  <body>
    <span id="speech"></span>
    <span id="interim"></span>
  </body>
  <script type="text/javascript">
    function upgrade() {
      alert('Please use Google Chrome');
    }

    window.onload = function() {
      if (!(window.webkitSpeechRecognition) && !(window.speechRecognition)){
        upgrade();
      }
      spoken = document.getElementById('speech');
      guess = document.getElementById('interim');

      speech = new webkitSpeechRecognition() || speechRecognition();

      speech.continuous = false;
      speech.interimResults = true;
      speech.lang = 'en-US';
      speech.start();

      speech.onstart = function(){
        recognizing = true;
      }

      speech.onresult = function(event){
        var guess_transcript = '';
        var spoken_transcript = '';

        for (var i = event.resultIndex; i < event.results.length; i++) {
          if (event.results[i].isFinal) {
            spoken_transcript += event.results[i][0].transcript;
          } else {
            guess_transcript += event.results[i][0].transcript;
          }
        }

        spoken.innerHTML = spoken_transcript;
        guess.innerHTML = guess_transcript;

      };

      speech.onerror = function(event){
        console.error(event.error);
      };

      speech.onend = function (){
        recognizing = false;
        alert(spoken.innerHTML)
        reset();
      }
      function reset() {
        recog = false;
        guess.innerHTML = '';
        spoken.innerHTML = '';
        speech.start();
      }
    }
  </script>
</html>
